<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.huang.dao.SelectCourseMapper">


    <!--增-->
    <insert id="addSelectCourse" parameterType="SelectCourse">
        insert into select_course(cid, sid) VALUES (#{cid},#{sid})
    </insert>
    <!--删-->
    <delete id="deleteSelectCourse" parameterType="int">
        delete from select_course where id=#{id}
    </delete>

    <!--改-->
    <update id="updateSelectCourse" parameterType="SelectCourse">
        update select_course set cid=#{cid},sid=#{sid}
        where id=#{id}
    </update>

    <!--查-->
    <select id="querySelectCourseById" resultMap="selectCourseMap">
        select *  from select_course where id=#{id}
    </select>


    <select id="queryAllSelectCourse" resultMap="selectCourseMap">
        select s.*, c.course_name,u.userName from user u , course c,select_course s
        where s.sid=u.id and c.cid=s.cid
        <if test="userName">
            and u.userName like concat('%',#{userName},'%')
        </if>
        <if test="course_name!=null">
            and c.course_name like concat('%',#{course_name},'%')
        </if>
        limit #{from},#{pageSize}
    </select>

    <select id="queryTeacherAllCourse" resultMap="selectCourseMap">
        select s.*, c.course_name,u.userName from user u , course c,select_course s
        where s.sid=u.id and c.cid=s.cid

        <if test="user_code">
            and course_name in(select c1.course_name from user u1 , course c1
            where u1.userCode=c1.user_code and c1.user_code like concat('%',#{user_code},'%'))
        </if>
        <if test="userName">
            and u.userName like concat('%',#{userName},'%')
        </if>
        <if test="course_name!=null">
            and c.course_name like concat('%',#{course_name},'%')
        </if>

        limit #{from},#{pageSize}
    </select>

    <select id="queryTeacherAllCount" resultType="_int">
        select count(s.id) from user u,course c,select_course s
        where s.sid=u.id and c.cid=s.cid

        <if test="user_code">
            and course_name in(select c1.course_name from user u1 , course c1
            where u1.userCode=c1.user_code and c1.user_code like concat('%',#{user_code},'%'))
        </if>
        <if test="userName">
            and u.userName like concat('%',#{userName},'%')
        </if>
        <if test="course_name!=null">
            and c.course_name like concat('%',#{course_name},'%')
        </if>

    </select>

    <!--Courseap值对应-->
    <resultMap id="selectCourseMap" type="selectCourse">
        <id property="id" column="id"></id>
        <id property="cid" column="cid"></id>
        <id property="sid" column="sid"></id>
        <id property="userName" column="userName"></id>
        <id property="courseName" column="course_name"></id>
        <id property="userCode" column="userCode"></id>


    </resultMap>


    <!--&lt;!&ndash;验证账号实现&ndash;&gt;-->
    <!--<select id="userCode" parameterType="int">-->
        <!--select * from user where userCode=#{userCode}-->
    <!--</select>-->

    <!--查询总人数-->
    <select id="getSelectCourseCount" resultType="_int">
        select count(select_course.id) from course,user,select_course where select_course.sid=user.id and select_course.cid = course.cid
            <if test="userName!=null">
                and userName like concat('%',#{userName},'%')
            </if>
            <if test="course_name!=null">
                and course_name like concat('%',#{course_name},'%')
            </if>
    </select>


</mapper>